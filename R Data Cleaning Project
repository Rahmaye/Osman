#install packages used in data cleaning and analysis

install.packages("readr") # read rectangular text data
install.packages("dplyr") # a grammar of data manipulation
install.packages("tidyr") # Tidy messy Data
install.packages("ggplot2") # create elegant data visualizations
install.packages("psych") # a package for procedures for research


library(tidyr)
library(readr)
library(dplyr)
library(ggplot2)
library(psych)


medical_raw_data <- read_csv("medical_raw_data.csv") #name and import data

View(medical_raw_data)

str(medical_raw_data) # explore the data set by viewing the number of rows and 
#columns, data types, etc.

medical <- medical_raw_data[,c(2,7,12,13,15:45)] #delete columns not relevant 


hist(medical$Age)

numericNA <- function(na) {mean(na, na.rm = TRUE)} #Create function to handle all NAs for numeric columns
numericNAColumns <- data.frame(sapply(medical[,c(3,6,7,10,14:17,23,28,33:35)], numericNA)) #apply function to all numeric columns
is.na(medical[,c(3,6,7,10,14:17,23,28,33:35)]) <- numericNAColumns #replace NAs in numeric columns

medical$Children[is.na(medical$Children)]<-mean(medical$Children, na.rm=TRUE)
medical$Age[is.na(medical$Age)]<-median(medical$Age, na.rm=TRUE)
medical$Gender[is.na(medical$Gender)]<-mean(medical$Gender, na.rm=TRUE)
medical$HighBlood[is.na(medical$HighBlood)]<-mean(medical$HighBlood, na.rm=TRUE)
medical$Complication_risk[is.na(medical$Complication_risk)]<-mean(medical$Complication_risk, na.rm=TRUE)
medical$Overweight[is.na(medical$Overweight)]<-mean(medical$Overweight, na.rm=TRUE)
medical$Anxiety[is.na(medical$Anxiety)]<-mean(medical$Anxiety, na.rm=TRUE)
medical$Allergic_rhinitis[is.na(medical$Allergic_rhinitis)]<-mean(medical$Allergic_rhinitis, na.rm=TRUE)
medical$Reflux_esophagitis[is.na(medical$Reflux_esophagitis)]<-mean(medical$Reflux_esophagitis, na.rm=TRUE)

hist(medical$Age)
#PCA - look at PCA for all x variables. 

medical.pca <- prcomp(medical, TRUE, TRUE) #medical = dataset True = centering variables relative
#to dataset 
# True 2: standardizes the input data so that there is zero mean and variance in the data

summary(medical.pca)

#build linear regression model to see relationship between complication risk and other variables

y <- medical$Complication_risk #identify dependent variable

medical.m <- lm (y~medical$Children + medical$Age + medical$Gender + medical$HighBlood
                  + medical$Overweight + medical$Anxiety + medical$Allergic_rhinitis
                 + medical$Reflux_esophagitis) #linear model: y~ designates an equation between
                  #dependent and independent variables. 

summary(medical.m)

plot(y ~ medical$Allergic_rhinitis)

#Only allergic_rhinitis is significant at the 0.01 significance level. This is the only 
# variable that can be used as a determinant of complication_risk

write_csv(medical,"Users/rahmoosman/Desktop/final medical dataset.csv", append = FALSE,) #Write final dataset to csv file.

